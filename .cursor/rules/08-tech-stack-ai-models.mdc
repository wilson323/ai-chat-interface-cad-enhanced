---
alwaysApply: true
---

# ZK-Agent æŠ€æœ¯æ ˆä¸AIæ¨¡å‹ç®¡ç†è§„èŒƒ

## ğŸ“‹ æ ¸å¿ƒæŠ€æœ¯æ ˆæ ‡å‡†

åŸºäº [æŠ€æœ¯é€‰å‹æ ‡å‡†](.kiro/steering/tech.md) å’Œ [æ¨¡å‹ç®¡ç†æ–‡æ¡£](.kiro/steering/model-management.md)ï¼Œç¡®ä¿æŠ€æœ¯æ ˆç»Ÿä¸€æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### å‰ç«¯æŠ€æœ¯æ ˆï¼ˆå¼ºåˆ¶è¦æ±‚ï¼‰
- **æ¡†æ¶**: Next.js 15.2.4 with App Routerï¼ˆå¿…éœ€ï¼‰
- **UIåè®®**: AG-UIåè®® + CopilotKitç»Ÿä¸€å‰ç«¯æ¡†æ¶
- **UIç»„ä»¶**: Radix UI + shadcn/ui ç»„ä»¶åº“
- **æ ·å¼**: Tailwind CSS + è®¾è®¡ä»¤ç‰Œç³»ç»Ÿ
- **çŠ¶æ€ç®¡ç†**: React Queryï¼ˆæœåŠ¡ç«¯çŠ¶æ€ï¼‰+ React Contextï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ï¼‰
- **èº«ä»½è®¤è¯**: NextAuth.js 4.24.11
- **ç±»å‹ç³»ç»Ÿ**: TypeScript 5.8.3 ä¸¥æ ¼æ¨¡å¼ï¼ˆç¦æ­¢ä½¿ç”¨ `any`ï¼‰

### åç«¯æŠ€æœ¯æ ˆï¼ˆæ¸è¿›å¼å¾®æœåŠ¡æ¶æ„ï¼‰
- **è¿è¡Œæ—¶**: Node.js 18+ï¼ˆä¸»è¦ï¼‰+ Python 3.11+ï¼ˆAIæœåŠ¡ï¼‰
- **æ•°æ®åº“**: PostgreSQL + Prisma ORMï¼ˆå…³ç³»å‹æ•°æ®ï¼‰
- **ç¼“å­˜**: Redis + iorediså®¢æˆ·ç«¯ï¼ˆç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- **å‘é‡æ•°æ®åº“**: Qdrant/Weaviateï¼ˆçŸ¥è¯†åº“æ£€ç´¢ï¼‰
- **æ–‡ä»¶å­˜å‚¨**: MinIO/S3ï¼ˆCADæ–‡ä»¶ã€æµ·æŠ¥ç­‰ï¼‰
- **åˆ†ææ•°æ®åº“**: ClickHouseï¼ˆä½¿ç”¨ç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡ï¼‰
- **API**: Next.js API Routes + FastAPIï¼ˆPythonï¼‰
- **å®æ—¶é€šä¿¡**: WebSocketsé›†ç¾¤ + Redis Streams
- **æ¶ˆæ¯é˜Ÿåˆ—**: Redis Streamsï¼ˆè½»é‡çº§ï¼‰/ Apache Kafkaï¼ˆé«˜ååé‡ï¼‰

### AIä¸æœºå™¨å­¦ä¹ æ ˆ
- **FastGPTé›†æˆ**: é€šè¿‡APIå¯†é’¥å’ŒAppIDå¯¹æ¥FastGPTå¹³å°æ™ºèƒ½ä½“
- **å¤šæ™ºèƒ½ä½“æ¡†æ¶**: AutoGen, CrewAI, LangGraph
- **æ¨¡å‹æä¾›å•†**: OpenAI, Anthropic, Cohere, Azure OpenAI
- **ç”Ÿæˆå¼UI**: CopilotKit + AG-UIåè®®ç»Ÿä¸€å¯¹è¯å¼æ“ä½œæ§åˆ¶
- **è‡ªç ”æ™ºèƒ½ä½“**: CADè§£è¯»æ™ºèƒ½ä½“, æµ·æŠ¥ç”Ÿæˆæ™ºèƒ½ä½“
- **çŸ¥è¯†åº“æ£€ç´¢**: FastGPTçŸ¥è¯†åº“æ£€ç´¢æ¥å£é›†æˆ + å‘é‡æœç´¢
- **æµå¼å¤„ç†**: æœåŠ¡å™¨å‘é€äº‹ä»¶å®ç°å®æ—¶AIå“åº”
- **æ¨¡å‹ç®¡ç†**: ç»Ÿä¸€æ¨¡å‹æ±  + è´Ÿè½½å‡è¡¡ + æˆæœ¬ä¼˜åŒ–
- **AIå®‰å…¨**: è¾“å…¥è¾“å‡ºè¿‡æ»¤ + æç¤ºæ³¨å…¥é˜²æŠ¤ + è®¿é—®æ§åˆ¶

## ğŸš€ å¼ºåˆ¶ä»£ç è§„èŒƒ

### å¯¼å…¥è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰
```typescript
// âœ… æ­£ç¡® - ä½¿ç”¨ç»å¯¹å¯¼å…¥
import { Button } from '@/components/ui/button'
import { ChatService } from '@/lib/services/chat-service'

// âŒ é”™è¯¯ - ç¦æ­¢ç›¸å¯¹å¯¼å…¥
import { Button } from '../../../components/ui/button'
```

### æ–‡ä»¶å‘½åè§„èŒƒ
- **ç»„ä»¶æ–‡ä»¶**: `PascalCase.tsx`ï¼ˆå¦‚: `ChatInterface.tsx`ï¼‰
- **å·¥å…·æ–‡ä»¶**: `kebab-case.ts`ï¼ˆå¦‚: `api-client.ts`ï¼‰
- **é¡µé¢æ–‡ä»¶**: `page.tsx`, `layout.tsx`, `loading.tsx`
- **ç±»å‹æ–‡ä»¶**: `kebab-case.ts`ï¼ˆå¦‚: `user-types.ts`ï¼‰

### ç»„ä»¶æ¶æ„æ ‡å‡†
```typescript
// âœ… æœåŠ¡ç«¯ç»„ä»¶ï¼ˆé»˜è®¤ï¼‰- ç”¨äºæ•°æ®è·å–
export default async function ServerComponent() {
  const data = await fetchData()
  return <div>{data}</div>
}

// âœ… å®¢æˆ·ç«¯ç»„ä»¶ - ä»…åœ¨éœ€è¦äº¤äº’æ—¶ä½¿ç”¨
'use client'
import { useState } from 'react'

export default function ClientComponent() {
  const [state, setState] = useState()
  return <button onClick={() => setState(!state)}>åˆ‡æ¢</button>
}
```

### æ•°æ®åº“æ“ä½œè§„èŒƒ
```typescript
// âœ… å•ä¸€æ“ä½œ
const user = await prisma.user.findUnique({
  where: { id: userId },
  include: { sessions: true }
})

// âœ… å¤šè¡¨æ“ä½œå¿…é¡»ä½¿ç”¨äº‹åŠ¡
await prisma.$transaction([
  prisma.user.update({ where: { id }, data: { name } }),
  prisma.session.create({ data: { userId: id } })
])
```

## ğŸ¤– AIæ¨¡å‹ç®¡ç†æ¶æ„

### æ¨¡å‹ç®¡ç†æ¦‚è¿°
ZK-Agentå¹³å°é‡‡ç”¨ç»Ÿä¸€çš„AIæ¨¡å‹ç®¡ç†æ¶æ„ï¼Œæ‰€æœ‰æ™ºèƒ½ä½“ï¼ˆé™¤FastGPTç›´æ¥å¯¹æ¥å¤–ï¼‰éƒ½é€šè¿‡ç®¡ç†å‘˜é…ç½®çš„æ¨¡å‹æ± è·å–AIèƒ½åŠ›ã€‚

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```typescript
interface ModelManagementArchitecture {
  modelConfigCenter: {
    purpose: "ç®¡ç†å‘˜ç»Ÿä¸€é…ç½®å„ç§AIæ¨¡å‹";
    features: ["æ¨¡å‹æ³¨å†Œ", "é…ç½®ç®¡ç†", "ç‰ˆæœ¬æ§åˆ¶"];
  };

  agentModelBinding: {
    purpose: "æ¯ä¸ªæ™ºèƒ½ä½“å¯é…ç½®ä½¿ç”¨çš„æ¨¡å‹";
    features: ["æ¨¡å‹ç»‘å®š", "èƒ½åŠ›åŒ¹é…", "é…ç½®ç»§æ‰¿"];
  };

  modelCallProxy: {
    purpose: "ç»Ÿä¸€çš„æ¨¡å‹è°ƒç”¨æ¥å£";
    features: ["åè®®é€‚é…", "è¯·æ±‚è·¯ç”±", "å“åº”å¤„ç†"];
  };

  loadBalancer: {
    purpose: "å¤šæ¨¡å‹å®ä¾‹çš„è´Ÿè½½åˆ†é…";
    features: ["è´Ÿè½½å‡è¡¡", "å¥åº·æ£€æŸ¥", "æ•…éšœè½¬ç§»"];
  };
}
```

### ç›®å½•ç»“æ„æ ‡å‡†
```
app/admin/models/
â”œâ”€â”€ page.tsx                    # æ¨¡å‹ç®¡ç†ä¸»é¡µé¢
â”œâ”€â”€ layout.tsx                  # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ providers/                  # æ¨¡å‹æä¾›å•†ç®¡ç†
â”œâ”€â”€ configurations/             # æ¨¡å‹é…ç½®
â”œâ”€â”€ monitoring/                 # æ¨¡å‹ç›‘æ§
â””â”€â”€ testing/                    # æ¨¡å‹æµ‹è¯•

lib/models/
â”œâ”€â”€ providers/                  # æ¨¡å‹æä¾›å•†é€‚é…å™¨
â”‚   â”œâ”€â”€ openai-provider.ts     # OpenAIé€‚é…å™¨
â”‚   â”œâ”€â”€ anthropic-provider.ts  # Anthropicé€‚é…å™¨
â”‚   â”œâ”€â”€ azure-provider.ts      # Azure OpenAIé€‚é…å™¨
â”‚   â””â”€â”€ base-provider.ts       # åŸºç¡€æä¾›å•†æ¥å£
â”œâ”€â”€ manager/                    # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ model-manager.ts       # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ load-balancer.ts       # è´Ÿè½½å‡è¡¡å™¨
â”‚   â””â”€â”€ health-checker.ts      # å¥åº·æ£€æŸ¥
â””â”€â”€ types/                      # æ¨¡å‹ç›¸å…³ç±»å‹
```

## ğŸ¯ æ”¯æŒçš„æ¨¡å‹ç±»å‹

### æ–‡æœ¬ç”Ÿæˆæ¨¡å‹
- **OpenAI**: GPT-4, GPT-3.5-turbo, GPT-4-turbo
- **Anthropic**: Claude-3, Claude-2, Claude-instant
- **Cohere**: Command, Command-light
- **Azure OpenAI**: ä¼ä¸šçº§GPTæ¨¡å‹
- **æœ¬åœ°æ¨¡å‹**: Llama, Mistral, å…¶ä»–å¼€æºæ¨¡å‹

### å¤šæ¨¡æ€æ¨¡å‹
- **è¯­éŸ³è¯†åˆ«**: OpenAI Whisper, Azure Speech, Google Speech-to-Text
- **è¯­éŸ³åˆæˆ**: OpenAI TTS, Azure Speech, ElevenLabs
- **å›¾åƒç”Ÿæˆ**: DALL-E 3, Midjourney, Stable Diffusion

## ğŸ’¾ æ¨¡å‹é…ç½®æ•°æ®ç»“æ„

### æ¨¡å‹é…ç½®è¡¨ç»“æ„
```sql
-- AIæ¨¡å‹é…ç½®è¡¨
CREATE TABLE ai_models (
  id VARCHAR PRIMARY KEY,
  name VARCHAR NOT NULL,              -- æ¨¡å‹åç§°
  provider VARCHAR NOT NULL,          -- æä¾›å•† (openai, anthropic, cohereç­‰)
  model_type VARCHAR NOT NULL,        -- æ¨¡å‹ç±»å‹
  version VARCHAR,                    -- æ¨¡å‹ç‰ˆæœ¬
  endpoint VARCHAR,                   -- APIç«¯ç‚¹
  api_key VARCHAR,                    -- APIå¯†é’¥ (åŠ å¯†å­˜å‚¨)
  max_tokens INTEGER,                 -- æœ€å¤§tokenæ•°
  temperature FLOAT,                  -- é»˜è®¤æ¸©åº¦
  config JSONB,                       -- æ¨¡å‹ç‰¹å®šé…ç½®
  is_active BOOLEAN DEFAULT true,     -- æ˜¯å¦å¯ç”¨
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- æ™ºèƒ½ä½“æ¨¡å‹ç»‘å®šè¡¨
CREATE TABLE agent_model_bindings (
  id VARCHAR PRIMARY KEY,
  agent_id VARCHAR NOT NULL,          -- æ™ºèƒ½ä½“ID
  model_id VARCHAR NOT NULL,          -- æ¨¡å‹ID
  is_primary BOOLEAN DEFAULT false,   -- æ˜¯å¦ä¸ºä¸»æ¨¡å‹
  fallback_order INTEGER,             -- å¤‡ç”¨é¡ºåº
  custom_config JSONB,                -- è‡ªå®šä¹‰é…ç½®
  FOREIGN KEY (model_id) REFERENCES ai_models(id)
);
```

### TypeScriptç±»å‹å®šä¹‰
```typescript
// æ¨¡å‹æä¾›å•†ç±»å‹
export type ModelProvider = 'openai' | 'anthropic' | 'cohere' | 'azure' | 'local';

// æ¨¡å‹ç±»å‹æšä¸¾
export type ModelType =
  | 'text-generation'
  | 'speech-recognition'
  | 'speech-synthesis'
  | 'image-generation'
  | 'embedding';

// æ¨¡å‹é…ç½®æ¥å£
export interface ModelConfig {
  id: string;
  name: string;
  provider: ModelProvider;
  modelType: ModelType;
  version?: string;
  endpoint?: string;
  apiKey: string;
  maxTokens?: number;
  temperature?: number;
  config?: Record<string, any>;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// æ¨¡å‹è°ƒç”¨è¯·æ±‚æ¥å£
export interface ModelCallRequest {
  modelId: string;
  prompt: string;
  parameters?: {
    temperature?: number;
    maxTokens?: number;
    topP?: number;
    stream?: boolean;
  };
  metadata?: {
    userId?: string;
    agentId?: string;
    sessionId?: string;
  };
}
```

## ğŸ”§ æ¨¡å‹ç®¡ç†å™¨å®ç°

### åŸºç¡€æ¨¡å‹ç®¡ç†å™¨
```typescript
/**
 * AIæ¨¡å‹ç®¡ç†å™¨
 *
 * è´Ÿè´£ç»Ÿä¸€ç®¡ç†æ‰€æœ‰AIæ¨¡å‹çš„é…ç½®ã€è°ƒç”¨å’Œç›‘æ§
 */
export class ModelManager {
  private models: Map<string, ModelConfig> = new Map();
  private providers: Map<ModelProvider, BaseProvider> = new Map();
  private loadBalancer: LoadBalancer;
  private healthChecker: HealthChecker;

  constructor() {
    this.loadBalancer = new LoadBalancer();
    this.healthChecker = new HealthChecker();
    this.initializeProviders();
  }

  /**
   * åˆå§‹åŒ–æ¨¡å‹æä¾›å•†
   */
  private initializeProviders(): void {
    this.providers.set('openai', new OpenAIProvider());
    this.providers.set('anthropic', new AnthropicProvider());
    this.providers.set('azure', new AzureProvider());
    this.providers.set('cohere', new CohereProvider());
  }

  /**
   * æ³¨å†Œæ¨¡å‹
   *
   * @param config æ¨¡å‹é…ç½®
   */
  async registerModel(config: ModelConfig): Promise<void> {
    // éªŒè¯æ¨¡å‹é…ç½®
    await this.validateModelConfig(config);

    // æµ‹è¯•æ¨¡å‹è¿æ¥
    await this.testModelConnection(config);

    // æ³¨å†Œæ¨¡å‹
    this.models.set(config.id, config);

    // å¯åŠ¨å¥åº·æ£€æŸ¥
    this.healthChecker.addModel(config.id);

    console.log(`æ¨¡å‹ ${config.name} æ³¨å†ŒæˆåŠŸ`);
  }

  /**
   * è°ƒç”¨æ¨¡å‹
   *
   * @param request è°ƒç”¨è¯·æ±‚
   * @returns æ¨¡å‹å“åº”
   */
  async callModel(request: ModelCallRequest): Promise<ModelResponse> {
    const model = this.models.get(request.modelId);
    if (!model) {
      throw new Error(`æ¨¡å‹ ${request.modelId} ä¸å­˜åœ¨`);
    }

    const provider = this.providers.get(model.provider);
    if (!provider) {
      throw new Error(`æä¾›å•† ${model.provider} ä¸æ”¯æŒ`);
    }

    // è´Ÿè½½å‡è¡¡é€‰æ‹©å®ä¾‹
    const instance = await this.loadBalancer.selectInstance(model.id);

    try {
      // è°ƒç”¨æ¨¡å‹
      const response = await provider.call(model, request, instance);

      // è®°å½•ä½¿ç”¨ç»Ÿè®¡
      await this.recordUsage(model.id, request, response);

      return response;
    } catch (error) {
      // å¤„ç†é”™è¯¯å’Œæ•…éšœè½¬ç§»
      await this.handleError(model.id, error);
      throw error;
    }
  }

  /**
   * éªŒè¯æ¨¡å‹é…ç½®
   */
  private async validateModelConfig(config: ModelConfig): Promise<void> {
    if (!config.name || !config.provider || !config.modelType) {
      throw new Error('æ¨¡å‹é…ç½®ç¼ºå°‘å¿…è¦å­—æ®µ');
    }

    if (!this.providers.has(config.provider)) {
      throw new Error(`ä¸æ”¯æŒçš„æä¾›å•†: ${config.provider}`);
    }
  }

  /**
   * æµ‹è¯•æ¨¡å‹è¿æ¥
   */
  private async testModelConnection(config: ModelConfig): Promise<void> {
    const provider = this.providers.get(config.provider)!;
    await provider.testConnection(config);
  }

  /**
   * è®°å½•ä½¿ç”¨ç»Ÿè®¡
   */
  private async recordUsage(
    modelId: string,
    request: ModelCallRequest,
    response: ModelResponse
  ): Promise<void> {
    // å®ç°ä½¿ç”¨ç»Ÿè®¡è®°å½•é€»è¾‘
  }

  /**
   * å¤„ç†é”™è¯¯
   */
  private async handleError(modelId: string, error: Error): Promise<void> {
    // å®ç°é”™è¯¯å¤„ç†å’Œæ•…éšœè½¬ç§»é€»è¾‘
  }
}
```

## âš ï¸ æŠ€æœ¯çº¦æŸä¸ç¦æ­¢é¡¹

### å¼ºåˆ¶è¦æ±‚
1. **ç¦æ­¢ä½¿ç”¨anyç±»å‹**: TypeScriptå¿…é¡»ä¸¥æ ¼æ¨¡å¼
2. **ç¦æ­¢ç›¸å¯¹å¯¼å…¥**: ç»Ÿä¸€ä½¿ç”¨@/å‰ç¼€çš„ç»å¯¹å¯¼å…¥
3. **ç¦æ­¢ç›´æ¥æ•°æ®åº“æ“ä½œ**: å¿…é¡»é€šè¿‡Prisma ORM
4. **ç¦æ­¢è·³è¿‡æ¨¡å‹ç®¡ç†**: æ‰€æœ‰AIè°ƒç”¨å¿…é¡»é€šè¿‡æ¨¡å‹ç®¡ç†å™¨

### æœ€ä½³å®è·µ
1. **ä¼˜å…ˆæœåŠ¡ç«¯ç»„ä»¶**: å‡å°‘å®¢æˆ·ç«¯JavaScriptåŒ…å¤§å°
2. **ä½¿ç”¨äº‹åŠ¡**: å¤šè¡¨æ“ä½œå¿…é¡»åŸå­æ€§
3. **æ¨¡å‹é™çº§**: é…ç½®æ¨¡å‹æ•…éšœè½¬ç§»ç­–ç•¥
4. **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨Redisç¼“å­˜æå‡æ€§èƒ½

---

**å‚è€ƒæ–‡æ¡£**:
- [æŠ€æœ¯é€‰å‹æ ‡å‡†](.kiro/steering/tech.md)
- [æ¨¡å‹ç®¡ç†æ–‡æ¡£](.kiro/steering/model-management.md)
- [é¡¹ç›®æ¶æ„è§„èŒƒ](.cursor/rules/01-project-architecture.mdc)
- [å¼€å‘è§„èŒƒ](.cursor/rules/02-development-standards.mdc)
# ZK-Agent æŠ€æœ¯æ ˆä¸AIæ¨¡å‹ç®¡ç†è§„èŒƒ

## ğŸ“‹ æ ¸å¿ƒæŠ€æœ¯æ ˆæ ‡å‡†

åŸºäº [æŠ€æœ¯é€‰å‹æ ‡å‡†](.kiro/steering/tech.md) å’Œ [æ¨¡å‹ç®¡ç†æ–‡æ¡£](.kiro/steering/model-management.md)ï¼Œç¡®ä¿æŠ€æœ¯æ ˆç»Ÿä¸€æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### å‰ç«¯æŠ€æœ¯æ ˆï¼ˆå¼ºåˆ¶è¦æ±‚ï¼‰
- **æ¡†æ¶**: Next.js 15.2.4 with App Routerï¼ˆå¿…éœ€ï¼‰
- **UIåè®®**: AG-UIåè®® + CopilotKitç»Ÿä¸€å‰ç«¯æ¡†æ¶
- **UIç»„ä»¶**: Radix UI + shadcn/ui ç»„ä»¶åº“
- **æ ·å¼**: Tailwind CSS + è®¾è®¡ä»¤ç‰Œç³»ç»Ÿ
- **çŠ¶æ€ç®¡ç†**: React Queryï¼ˆæœåŠ¡ç«¯çŠ¶æ€ï¼‰+ React Contextï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ï¼‰
- **èº«ä»½è®¤è¯**: NextAuth.js 4.24.11
- **ç±»å‹ç³»ç»Ÿ**: TypeScript 5.8.3 ä¸¥æ ¼æ¨¡å¼ï¼ˆç¦æ­¢ä½¿ç”¨ `any`ï¼‰

### åç«¯æŠ€æœ¯æ ˆï¼ˆæ¸è¿›å¼å¾®æœåŠ¡æ¶æ„ï¼‰
- **è¿è¡Œæ—¶**: Node.js 18+ï¼ˆä¸»è¦ï¼‰+ Python 3.11+ï¼ˆAIæœåŠ¡ï¼‰
- **æ•°æ®åº“**: PostgreSQL + Prisma ORMï¼ˆå…³ç³»å‹æ•°æ®ï¼‰
- **ç¼“å­˜**: Redis + iorediså®¢æˆ·ç«¯ï¼ˆç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- **å‘é‡æ•°æ®åº“**: Qdrant/Weaviateï¼ˆçŸ¥è¯†åº“æ£€ç´¢ï¼‰
- **æ–‡ä»¶å­˜å‚¨**: MinIO/S3ï¼ˆCADæ–‡ä»¶ã€æµ·æŠ¥ç­‰ï¼‰
- **åˆ†ææ•°æ®åº“**: ClickHouseï¼ˆä½¿ç”¨ç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡ï¼‰
- **API**: Next.js API Routes + FastAPIï¼ˆPythonï¼‰
- **å®æ—¶é€šä¿¡**: WebSocketsé›†ç¾¤ + Redis Streams
- **æ¶ˆæ¯é˜Ÿåˆ—**: Redis Streamsï¼ˆè½»é‡çº§ï¼‰/ Apache Kafkaï¼ˆé«˜ååé‡ï¼‰

### AIä¸æœºå™¨å­¦ä¹ æ ˆ
- **FastGPTé›†æˆ**: é€šè¿‡APIå¯†é’¥å’ŒAppIDå¯¹æ¥FastGPTå¹³å°æ™ºèƒ½ä½“
- **å¤šæ™ºèƒ½ä½“æ¡†æ¶**: AutoGen, CrewAI, LangGraph
- **æ¨¡å‹æä¾›å•†**: OpenAI, Anthropic, Cohere, Azure OpenAI
- **ç”Ÿæˆå¼UI**: CopilotKit + AG-UIåè®®ç»Ÿä¸€å¯¹è¯å¼æ“ä½œæ§åˆ¶
- **è‡ªç ”æ™ºèƒ½ä½“**: CADè§£è¯»æ™ºèƒ½ä½“, æµ·æŠ¥ç”Ÿæˆæ™ºèƒ½ä½“
- **çŸ¥è¯†åº“æ£€ç´¢**: FastGPTçŸ¥è¯†åº“æ£€ç´¢æ¥å£é›†æˆ + å‘é‡æœç´¢
- **æµå¼å¤„ç†**: æœåŠ¡å™¨å‘é€äº‹ä»¶å®ç°å®æ—¶AIå“åº”
- **æ¨¡å‹ç®¡ç†**: ç»Ÿä¸€æ¨¡å‹æ±  + è´Ÿè½½å‡è¡¡ + æˆæœ¬ä¼˜åŒ–
- **AIå®‰å…¨**: è¾“å…¥è¾“å‡ºè¿‡æ»¤ + æç¤ºæ³¨å…¥é˜²æŠ¤ + è®¿é—®æ§åˆ¶

## ğŸš€ å¼ºåˆ¶ä»£ç è§„èŒƒ

### å¯¼å…¥è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰
```typescript
// âœ… æ­£ç¡® - ä½¿ç”¨ç»å¯¹å¯¼å…¥
import { Button } from '@/components/ui/button'
import { ChatService } from '@/lib/services/chat-service'

// âŒ é”™è¯¯ - ç¦æ­¢ç›¸å¯¹å¯¼å…¥
import { Button } from '../../../components/ui/button'
```

### æ–‡ä»¶å‘½åè§„èŒƒ
- **ç»„ä»¶æ–‡ä»¶**: `PascalCase.tsx`ï¼ˆå¦‚: `ChatInterface.tsx`ï¼‰
- **å·¥å…·æ–‡ä»¶**: `kebab-case.ts`ï¼ˆå¦‚: `api-client.ts`ï¼‰
- **é¡µé¢æ–‡ä»¶**: `page.tsx`, `layout.tsx`, `loading.tsx`
- **ç±»å‹æ–‡ä»¶**: `kebab-case.ts`ï¼ˆå¦‚: `user-types.ts`ï¼‰

### ç»„ä»¶æ¶æ„æ ‡å‡†
```typescript
// âœ… æœåŠ¡ç«¯ç»„ä»¶ï¼ˆé»˜è®¤ï¼‰- ç”¨äºæ•°æ®è·å–
export default async function ServerComponent() {
  const data = await fetchData()
  return <div>{data}</div>
}

// âœ… å®¢æˆ·ç«¯ç»„ä»¶ - ä»…åœ¨éœ€è¦äº¤äº’æ—¶ä½¿ç”¨
'use client'
import { useState } from 'react'

export default function ClientComponent() {
  const [state, setState] = useState()
  return <button onClick={() => setState(!state)}>åˆ‡æ¢</button>
}
```

### æ•°æ®åº“æ“ä½œè§„èŒƒ
```typescript
// âœ… å•ä¸€æ“ä½œ
const user = await prisma.user.findUnique({
  where: { id: userId },
  include: { sessions: true }
})

// âœ… å¤šè¡¨æ“ä½œå¿…é¡»ä½¿ç”¨äº‹åŠ¡
await prisma.$transaction([
  prisma.user.update({ where: { id }, data: { name } }),
  prisma.session.create({ data: { userId: id } })
])
```

## ğŸ¤– AIæ¨¡å‹ç®¡ç†æ¶æ„

### æ¨¡å‹ç®¡ç†æ¦‚è¿°
ZK-Agentå¹³å°é‡‡ç”¨ç»Ÿä¸€çš„AIæ¨¡å‹ç®¡ç†æ¶æ„ï¼Œæ‰€æœ‰æ™ºèƒ½ä½“ï¼ˆé™¤FastGPTç›´æ¥å¯¹æ¥å¤–ï¼‰éƒ½é€šè¿‡ç®¡ç†å‘˜é…ç½®çš„æ¨¡å‹æ± è·å–AIèƒ½åŠ›ã€‚

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```typescript
interface ModelManagementArchitecture {
  modelConfigCenter: {
    purpose: "ç®¡ç†å‘˜ç»Ÿä¸€é…ç½®å„ç§AIæ¨¡å‹";
    features: ["æ¨¡å‹æ³¨å†Œ", "é…ç½®ç®¡ç†", "ç‰ˆæœ¬æ§åˆ¶"];
  };

  agentModelBinding: {
    purpose: "æ¯ä¸ªæ™ºèƒ½ä½“å¯é…ç½®ä½¿ç”¨çš„æ¨¡å‹";
    features: ["æ¨¡å‹ç»‘å®š", "èƒ½åŠ›åŒ¹é…", "é…ç½®ç»§æ‰¿"];
  };

  modelCallProxy: {
    purpose: "ç»Ÿä¸€çš„æ¨¡å‹è°ƒç”¨æ¥å£";
    features: ["åè®®é€‚é…", "è¯·æ±‚è·¯ç”±", "å“åº”å¤„ç†"];
  };

  loadBalancer: {
    purpose: "å¤šæ¨¡å‹å®ä¾‹çš„è´Ÿè½½åˆ†é…";
    features: ["è´Ÿè½½å‡è¡¡", "å¥åº·æ£€æŸ¥", "æ•…éšœè½¬ç§»"];
  };
}
```

### ç›®å½•ç»“æ„æ ‡å‡†
```
app/admin/models/
â”œâ”€â”€ page.tsx                    # æ¨¡å‹ç®¡ç†ä¸»é¡µé¢
â”œâ”€â”€ layout.tsx                  # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ providers/                  # æ¨¡å‹æä¾›å•†ç®¡ç†
â”œâ”€â”€ configurations/             # æ¨¡å‹é…ç½®
â”œâ”€â”€ monitoring/                 # æ¨¡å‹ç›‘æ§
â””â”€â”€ testing/                    # æ¨¡å‹æµ‹è¯•

lib/models/
â”œâ”€â”€ providers/                  # æ¨¡å‹æä¾›å•†é€‚é…å™¨
â”‚   â”œâ”€â”€ openai-provider.ts     # OpenAIé€‚é…å™¨
â”‚   â”œâ”€â”€ anthropic-provider.ts  # Anthropicé€‚é…å™¨
â”‚   â”œâ”€â”€ azure-provider.ts      # Azure OpenAIé€‚é…å™¨
â”‚   â””â”€â”€ base-provider.ts       # åŸºç¡€æä¾›å•†æ¥å£
â”œâ”€â”€ manager/                    # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ model-manager.ts       # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ load-balancer.ts       # è´Ÿè½½å‡è¡¡å™¨
â”‚   â””â”€â”€ health-checker.ts      # å¥åº·æ£€æŸ¥
â””â”€â”€ types/                      # æ¨¡å‹ç›¸å…³ç±»å‹
```

## ğŸ¯ æ”¯æŒçš„æ¨¡å‹ç±»å‹

### æ–‡æœ¬ç”Ÿæˆæ¨¡å‹
- **OpenAI**: GPT-4, GPT-3.5-turbo, GPT-4-turbo
- **Anthropic**: Claude-3, Claude-2, Claude-instant
- **Cohere**: Command, Command-light
- **Azure OpenAI**: ä¼ä¸šçº§GPTæ¨¡å‹
- **æœ¬åœ°æ¨¡å‹**: Llama, Mistral, å…¶ä»–å¼€æºæ¨¡å‹

### å¤šæ¨¡æ€æ¨¡å‹
- **è¯­éŸ³è¯†åˆ«**: OpenAI Whisper, Azure Speech, Google Speech-to-Text
- **è¯­éŸ³åˆæˆ**: OpenAI TTS, Azure Speech, ElevenLabs
- **å›¾åƒç”Ÿæˆ**: DALL-E 3, Midjourney, Stable Diffusion

## ğŸ’¾ æ¨¡å‹é…ç½®æ•°æ®ç»“æ„

### æ¨¡å‹é…ç½®è¡¨ç»“æ„
```sql
-- AIæ¨¡å‹é…ç½®è¡¨
CREATE TABLE ai_models (
  id VARCHAR PRIMARY KEY,
  name VARCHAR NOT NULL,              -- æ¨¡å‹åç§°
  provider VARCHAR NOT NULL,          -- æä¾›å•† (openai, anthropic, cohereç­‰)
  model_type VARCHAR NOT NULL,        -- æ¨¡å‹ç±»å‹
  version VARCHAR,                    -- æ¨¡å‹ç‰ˆæœ¬
  endpoint VARCHAR,                   -- APIç«¯ç‚¹
  api_key VARCHAR,                    -- APIå¯†é’¥ (åŠ å¯†å­˜å‚¨)
  max_tokens INTEGER,                 -- æœ€å¤§tokenæ•°
  temperature FLOAT,                  -- é»˜è®¤æ¸©åº¦
  config JSONB,                       -- æ¨¡å‹ç‰¹å®šé…ç½®
  is_active BOOLEAN DEFAULT true,     -- æ˜¯å¦å¯ç”¨
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- æ™ºèƒ½ä½“æ¨¡å‹ç»‘å®šè¡¨
CREATE TABLE agent_model_bindings (
  id VARCHAR PRIMARY KEY,
  agent_id VARCHAR NOT NULL,          -- æ™ºèƒ½ä½“ID
  model_id VARCHAR NOT NULL,          -- æ¨¡å‹ID
  is_primary BOOLEAN DEFAULT false,   -- æ˜¯å¦ä¸ºä¸»æ¨¡å‹
  fallback_order INTEGER,             -- å¤‡ç”¨é¡ºåº
  custom_config JSONB,                -- è‡ªå®šä¹‰é…ç½®
  FOREIGN KEY (model_id) REFERENCES ai_models(id)
);
```

### TypeScriptç±»å‹å®šä¹‰
```typescript
// æ¨¡å‹æä¾›å•†ç±»å‹
export type ModelProvider = 'openai' | 'anthropic' | 'cohere' | 'azure' | 'local';

// æ¨¡å‹ç±»å‹æšä¸¾
export type ModelType =
  | 'text-generation'
  | 'speech-recognition'
  | 'speech-synthesis'
  | 'image-generation'
  | 'embedding';

// æ¨¡å‹é…ç½®æ¥å£
export interface ModelConfig {
  id: string;
  name: string;
  provider: ModelProvider;
  modelType: ModelType;
  version?: string;
  endpoint?: string;
  apiKey: string;
  maxTokens?: number;
  temperature?: number;
  config?: Record<string, any>;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// æ¨¡å‹è°ƒç”¨è¯·æ±‚æ¥å£
export interface ModelCallRequest {
  modelId: string;
  prompt: string;
  parameters?: {
    temperature?: number;
    maxTokens?: number;
    topP?: number;
    stream?: boolean;
  };
  metadata?: {
    userId?: string;
    agentId?: string;
    sessionId?: string;
  };
}
```

## ğŸ”§ æ¨¡å‹ç®¡ç†å™¨å®ç°

### åŸºç¡€æ¨¡å‹ç®¡ç†å™¨
```typescript
/**
 * AIæ¨¡å‹ç®¡ç†å™¨
 *
 * è´Ÿè´£ç»Ÿä¸€ç®¡ç†æ‰€æœ‰AIæ¨¡å‹çš„é…ç½®ã€è°ƒç”¨å’Œç›‘æ§
 */
export class ModelManager {
  private models: Map<string, ModelConfig> = new Map();
  private providers: Map<ModelProvider, BaseProvider> = new Map();
  private loadBalancer: LoadBalancer;
  private healthChecker: HealthChecker;

  constructor() {
    this.loadBalancer = new LoadBalancer();
    this.healthChecker = new HealthChecker();
    this.initializeProviders();
  }

  /**
   * åˆå§‹åŒ–æ¨¡å‹æä¾›å•†
   */
  private initializeProviders(): void {
    this.providers.set('openai', new OpenAIProvider());
    this.providers.set('anthropic', new AnthropicProvider());
    this.providers.set('azure', new AzureProvider());
    this.providers.set('cohere', new CohereProvider());
  }

  /**
   * æ³¨å†Œæ¨¡å‹
   *
   * @param config æ¨¡å‹é…ç½®
   */
  async registerModel(config: ModelConfig): Promise<void> {
    // éªŒè¯æ¨¡å‹é…ç½®
    await this.validateModelConfig(config);

    // æµ‹è¯•æ¨¡å‹è¿æ¥
    await this.testModelConnection(config);

    // æ³¨å†Œæ¨¡å‹
    this.models.set(config.id, config);

    // å¯åŠ¨å¥åº·æ£€æŸ¥
    this.healthChecker.addModel(config.id);

    console.log(`æ¨¡å‹ ${config.name} æ³¨å†ŒæˆåŠŸ`);
  }

  /**
   * è°ƒç”¨æ¨¡å‹
   *
   * @param request è°ƒç”¨è¯·æ±‚
   * @returns æ¨¡å‹å“åº”
   */
  async callModel(request: ModelCallRequest): Promise<ModelResponse> {
    const model = this.models.get(request.modelId);
    if (!model) {
      throw new Error(`æ¨¡å‹ ${request.modelId} ä¸å­˜åœ¨`);
    }

    const provider = this.providers.get(model.provider);
    if (!provider) {
      throw new Error(`æä¾›å•† ${model.provider} ä¸æ”¯æŒ`);
    }

    // è´Ÿè½½å‡è¡¡é€‰æ‹©å®ä¾‹
    const instance = await this.loadBalancer.selectInstance(model.id);

    try {
      // è°ƒç”¨æ¨¡å‹
      const response = await provider.call(model, request, instance);

      // è®°å½•ä½¿ç”¨ç»Ÿè®¡
      await this.recordUsage(model.id, request, response);

      return response;
    } catch (error) {
      // å¤„ç†é”™è¯¯å’Œæ•…éšœè½¬ç§»
      await this.handleError(model.id, error);
      throw error;
    }
  }

  /**
   * éªŒè¯æ¨¡å‹é…ç½®
   */
  private async validateModelConfig(config: ModelConfig): Promise<void> {
    if (!config.name || !config.provider || !config.modelType) {
      throw new Error('æ¨¡å‹é…ç½®ç¼ºå°‘å¿…è¦å­—æ®µ');
    }

    if (!this.providers.has(config.provider)) {
      throw new Error(`ä¸æ”¯æŒçš„æä¾›å•†: ${config.provider}`);
    }
  }

  /**
   * æµ‹è¯•æ¨¡å‹è¿æ¥
   */
  private async testModelConnection(config: ModelConfig): Promise<void> {
    const provider = this.providers.get(config.provider)!;
    await provider.testConnection(config);
  }

  /**
   * è®°å½•ä½¿ç”¨ç»Ÿè®¡
   */
  private async recordUsage(
    modelId: string,
    request: ModelCallRequest,
    response: ModelResponse
  ): Promise<void> {
    // å®ç°ä½¿ç”¨ç»Ÿè®¡è®°å½•é€»è¾‘
  }

  /**
   * å¤„ç†é”™è¯¯
   */
  private async handleError(modelId: string, error: Error): Promise<void> {
    // å®ç°é”™è¯¯å¤„ç†å’Œæ•…éšœè½¬ç§»é€»è¾‘
  }
}
```

## âš ï¸ æŠ€æœ¯çº¦æŸä¸ç¦æ­¢é¡¹

### å¼ºåˆ¶è¦æ±‚
1. **ç¦æ­¢ä½¿ç”¨anyç±»å‹**: TypeScriptå¿…é¡»ä¸¥æ ¼æ¨¡å¼
2. **ç¦æ­¢ç›¸å¯¹å¯¼å…¥**: ç»Ÿä¸€ä½¿ç”¨@/å‰ç¼€çš„ç»å¯¹å¯¼å…¥
3. **ç¦æ­¢ç›´æ¥æ•°æ®åº“æ“ä½œ**: å¿…é¡»é€šè¿‡Prisma ORM
4. **ç¦æ­¢è·³è¿‡æ¨¡å‹ç®¡ç†**: æ‰€æœ‰AIè°ƒç”¨å¿…é¡»é€šè¿‡æ¨¡å‹ç®¡ç†å™¨

### æœ€ä½³å®è·µ
1. **ä¼˜å…ˆæœåŠ¡ç«¯ç»„ä»¶**: å‡å°‘å®¢æˆ·ç«¯JavaScriptåŒ…å¤§å°
2. **ä½¿ç”¨äº‹åŠ¡**: å¤šè¡¨æ“ä½œå¿…é¡»åŸå­æ€§
3. **æ¨¡å‹é™çº§**: é…ç½®æ¨¡å‹æ•…éšœè½¬ç§»ç­–ç•¥
4. **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨Redisç¼“å­˜æå‡æ€§èƒ½

---

**å‚è€ƒæ–‡æ¡£**:
- [æŠ€æœ¯é€‰å‹æ ‡å‡†](.kiro/steering/tech.md)
- [æ¨¡å‹ç®¡ç†æ–‡æ¡£](.kiro/steering/model-management.md)
- [é¡¹ç›®æ¶æ„è§„èŒƒ](.cursor/rules/01-project-architecture.mdc)
- [å¼€å‘è§„èŒƒ](.cursor/rules/02-development-standards.mdc)
